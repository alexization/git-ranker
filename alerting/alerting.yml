apiVersion: 1

contactPoints:
  - orgId: 1
    name: discord-alerts
    receivers:
      - uid: discord-webhook
        type: discord
        settings:
          url: ${DISCORD_WEBHOOK_URL}
          title: |
            {{ if eq .Status "firing" }}ğŸš¨ {{ .CommonLabels.alertname }} ({{ .Status | toUpper }})
            {{ else }}âœ… {{ .CommonLabels.alertname }} (RESOLVED){{ end }}
          message: |
            {{ range .Alerts }}
            **ğŸ”¥ Alert Triggered:** {{ .Annotations.summary }}

            **ğŸ“ Description:**
            {{ .Annotations.description }}

            **ğŸ·ï¸ Labels:**
            {{ range $key, $value := .Labels }}â€¢ **{{ $key }}:** {{ $value }}
            {{ end }}

            **ğŸ“Š Values:**
            {{ range $key, $value := .Values }}â€¢ **{{ $key }}:** {{ $value }}
            {{ end }}

            [ğŸ”´ View Dashboard]({{ .DashboardURL }}) | [ğŸ” View Panel]({{ .PanelURL }})
            ---
            {{ end }}
          avatar_url: https://raw.githubusercontent.com/grafana/grafana/main/public/img/grafana_icon.svg
        disableResolveMessage: false

policies:
  - orgId: 1
    receiver: discord-alerts
    group_by:
      - alertname
      - severity
    group_wait: 10s
    group_interval: 1m
    repeat_interval: 1h
    routes:
      - receiver: discord-alerts
        matchers:
          - severity = critical
        group_wait: 5s
        repeat_interval: 2m

      - receiver: discord-alerts
        matchers:
          - severity = warning
        group_wait: 10s
        repeat_interval: 2m